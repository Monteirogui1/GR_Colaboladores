{% extends 'layouts/base.html' %}

{% block title %}Máquinas - TI Manager{% endblock %}

{% block conteudo %}
<div class="content">
    <div class="page-header">
        <h1>Máquinas</h1>
        <a href="{% url 'inventario:machine_create' %}" class="btn btn-primary">Nova Máquina</a>
    </div>

    <!-- Formulário de filtros -->
    <form method="get" class="filter-form">
        <div class="form-group">
            <label for="hostname">Hostname</label>
            <input type="text" name="hostname" id="hostname" value="{{ request.GET.hostname }}" class="form-control" placeholder="Digite o hostname">
        </div>
        <div class="form-group">
            <label for="ip_address">IP</label>
            <input type="text" name="ip_address" id="ip_address" value="{{ request.GET.ip_address }}" class="form-control" placeholder="Ex: 192.168.1.100">
        </div>
        <div class="form-group">
            <label for="group">Grupo</label>
            <select name="group" id="group" class="form-control">
                <option value="">Todos</option>
                {% for grupo in grupos %}
                    <option value="{{ grupo.id }}" {% if request.GET.group == grupo.id|stringformat:"s" %}selected{% endif %}>
                        {{ grupo.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="is_online">Status</label>
            <select name="is_online" id="is_online" class="form-control">
                <option value="">Todos</option>
                <option value="true" {% if request.GET.is_online == "true" %}selected{% endif %}>Online</option>
                <option value="false" {% if request.GET.is_online == "false" %}selected{% endif %}>Offline</option>
            </select>
        </div>
        <div class="filter-buttons">
            <button type="submit" class="btn btn-primary">Filtrar</button>
            <a href="{% url 'inventario:machine_list' %}" class="btn btn-secondary">Limpar</a>
        </div>
    </form>

    <!-- Tabela de máquinas -->
    <table class="table">
        <thead>
            <tr>
                <th>Hostname</th>
                <th>IP</th>
                <th>Usuário</th>
                <th>Grupo</th>
                <th>RAM (GB)</th>
                <th>Disco Livre (GB)</th>
                <th>Status</th>
                <th>Última Conexão</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for machine in machines %}
            <tr>
                <td>{{ machine.hostname }}</td>
                <td>{{ machine.ip_address }}</td>
                <td>{{ machine.loggedUser|default:"-" }}</td>
                <td>{{ machine.group.name|default:"-" }}</td>
                <td>{{ machine.ram_gb|floatformat:2|default:"-" }}</td>
                <td>{{ machine.disk_free_gb|floatformat:2|default:"-" }}</td>
                <td>
                    {% if machine.is_online %}
                        <span style="color: green;">● Online</span>
                    {% else %}
                        <span style="color: red;">● Offline</span>
                    {% endif %}
                </td>
                <td>{{ machine.last_seen|date:"d/m/Y H:i" }}</td>
                <td>
                    <a href="{% url 'inventario:machine_detail' machine.pk %}" class="btn btn-sm btn-primary">Ver</a>
                    <a href="{% url 'inventario:machine_update' machine.pk %}" class="btn btn-sm btn-edit">Editar</a>
                    <button class="btn btn-sm btn-delete" data-id="{{ machine.id }}">Excluir</button>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="9" class="text-center">Nenhuma máquina cadastrada.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}